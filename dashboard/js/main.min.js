function checkAuth(){gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES.join(" "),immediate:!0},handleAuthResult)}function handleAuthResult(e){var t=document.getElementById("authorize-div");e&&!e.error?(t.style.display="none",loadCalendarApi()):t.style.display="block"}function handleAuthClick(e){return gapi.auth.authorize({client_id:CLIENT_ID,scope:SCOPES,immediate:!1},handleAuthResult),!1}function loadCalendarApi(){gapi.client.load("calendar","v3",listUpcomingEvents)}function listUpcomingEvents(){var e=gapi.client.calendar.events.list({calendarId:"primary",timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:settings.numberofCalenderActivities,orderBy:"startTime"});e.execute(function(e){var t=e.items;if(appendPre("Kommande saker i din kalender:"),t.length>0)for(i=0;i<t.length;i++){var n=t[i],a=n.start.dateTime;a||(a=n.start.date),appendPre(n.summary,a,t.length)}else appendPre("Du har ingenting i din kalender")})}function appendPre(e,t,n){var a=document.getElementsByClassName("calender")[0],r=document.createElement("li");r.className="calender-activity",activitySpan=document.createElement("span"),activitySpan.className="the-activity",activitySpan.innerText=e;var s=document.createElement("div");s.className="activity-date format-date",s.innerText=t,counter>0&&r.appendChild(s),r.appendChild(activitySpan),a.appendChild(r),counter==n&&formatDate(),counter++}function formatDate(){for(var e=document.getElementsByClassName("date")[0].innerText.toLowerCase(),t=document.getElementsByClassName("format-date"),n=0;n<t.length;n++)dateString=t[n].innerText.substr(0,10),t[n].innerText=t[n].innerText.replace("-",""),t[n].innerText=t[n].innerText.replace("-",""),t[n].innerText=t[n].innerText.replace("T",""),day=t[n].innerText.substr(6,2),month=t[n].innerText.substr(4,2),year=t[n].innerText.substr(0,4),time=t[n].innerText.substr(8,5),weekDay=weekDays[new Date(dateString).getDay()],weekDay=weekDay.substr(0,3),time.length>0?weekDay==e.substr(0,3)&&day==e.substr(7,2)&&months[month-1]==e.substr(10,5)?t[n].innerHTML="<div class='calender-date'>IDAG</div><div class='time-span'>Kl: "+time+"</div>":t[n].innerHTML="<div class='calender-date'>"+weekDay+" "+day+" "+months[month-1]+"</div><div class='time-span'>Kl: "+time+"</div>":weekDay==e.substr(0,3)&&day==e.substr(7,2)&&months[month-1]==e.substr(10,5)?t[n].innerHTML="<div class='calender-date'>IDAG</div><div class='time-span'>Heldag</div>":t[n].innerHTML="<div class='calender-date'>"+weekDay+" "+day+" "+months[month-1]+"</div><div class='time-span'>Heldag</div>"}!function(){"use strict";$(document).ready(function(){function e(){var e=new Date,t=e.getHours(),n=e.getMinutes(),a=e.getSeconds();n=(10>n?"0":"")+n,a=(10>a?"0":"")+a,$(".time").html(t+":"+n+":"+a)}function t(e){p(),y(),v()}function n(e,t){D.createUser({email:e,password:t},function(n,r){n?$(".error-message").html("Användarnamnet är upptaget eller felaktigt angivet"):(D.child("dashboardUsers").child(r.uid).set(A),a(e,t,!0))})}function a(e,t,n){d("toggle-settings"),n?K.innerHTML="Tack för att du registerat dig! Vi har fyllt i lite förslag på hur appen ska sättas upp. Välkommen att ändra efter eget huvud!":K.innerHTML="",D.authWithPassword({email:e,password:t},function(e,t){if(e)$(".error-message").html("Felaktiga uppgifter"),console.log("Login Failed!",e);else{document.getElementsByClassName("settings-container")[0].classList.toggle("open");for(var n=0;n<W.length;n++)W[n].innerHTML="Inloggad som "+t.password.email;d("user-settings-container"),c("sign-in-container");var a=D;j=D.getAuth(),a.on("value",function(e){var t=e.val();for(var n in t.dashboardUsers)if(n==j.uid)return H.value=t.dashboardUsers[n].numberofCalenderActivities,x.value=t.dashboardUsers[n].twitterAccount,I.value=t.dashboardUsers[n].numberofTweets,B.value=t.dashboardUsers[n].numberofWeatherRapports,R.value=t.dashboardUsers[n].intervalOfWeatherRapports,S.checked=t.dashboardUsers[n].showDeparturesNow,1==S.checked?U.innerHTML="Ja":U.innerHTML="Nej",!1},function(e){})}})}function r(e){e?(console.log("Någon är inloggad"),d("user-settings-container"),d("header-out-container"),d("toggle-settings"),c("sign-in-container"),c("header-in-container"),D.child("dashboardUsers").child(D.getAuth().uid).once("value",function(e){settings=e.val(),0!=O&&t("authDataCallback(authData)"),O++})):(d("header-in-container"),d("sign-in-container"),c("header-out-container"))}function s(){W[0].innerHTML="",d("sign-in-container"),c("toggle-settings"),c("user-settings-container"),D.unauth(),l(),settings={numberofCalenderActivities:3,twitterAccount:"dagensnyheter",numberofTweets:5,numberofWeatherRapports:4,intervalOfWeatherRapports:8,showDeparturesNow:!1},t("logOut()")}function i(){D.child("dashboardUsers").child(D.getAuth().uid).update({numberofCalenderActivities:o(H.value),twitterAccount:x.value,numberofTweets:o(I.value),numberofWeatherRapports:o(B.value),intervalOfWeatherRapports:o(R.value),showDeparturesNow:S.checked})}function o(e){return 0==isNaN(e)?e:"1"}function l(){H.value="",x.value="",I.value="",B.value="",R.value="",S.checked=!1,U.innerHTML="Nej"}function d(e){document.getElementsByClassName(e)[0].style.display="block"}function c(e){document.getElementsByClassName(e)[0].style.display="none"}function u(){navigator.geolocation?navigator.geolocation.getCurrentPosition(m):alert("Geolocation stödjs inte i den här browsern och vi kan därför inte hitta din plats")}function m(e){Y=e.coords.latitude,z=e.coords.longitude,g(Y,z)}function p(){var e="http://opendata-download-metfcst.smhi.se/api/category/pmp1.5g/version/1/geopoint/lat/59.32/lon/18.05/data.json";$(".weather-container").html(""),$.ajax({type:"GET",url:e,dataType:"JSON",success:function(e){function t(){for(var e=0;e<r.length;e++)if(r[e].validTime.substr(8,2)==N&&r[e].validTime.substr(11,2)==n.getHours())return s=e,!1}var n=new Date,a=[],r=e.timeseries;N=n.getDate();var s=0;t();var i;i=settings.intervalOfWeatherRapports*settings.numberofWeatherRapports;for(var o=parseInt(settings.intervalOfWeatherRapports),l=s;i+s>l;l+=o)a.push(r[l]);for(var d=["flaticon-weather-1","flaticon-weather-5","flaticon-weather-4","flaticon-weather-4","flaticon-cloud","flaticon-cloud","flaticon-cloud-2","flaticon-sky","flaticon-sky","flaticon-sky"],c=["flaticon-weather-3","flaticon-cloud-1"],u=["Klart","Överlag klart","Halvklart","Lätt molnighet","Lite moln","Överlag molnigt","Molnigt","Mulet","Mulet","Kraftigt molntäcke"],m=0;m<a.length;m++){var p=document.createElement("div");p.className="observation";var h=document.createElement("h4"),v=a[m].validTime.substr(8,2),g=a[m].validTime.substr(5,2);0==m?h.innerHTML="Just nu":v==N?h.innerHTML="Idag <br>klockan "+a[m].validTime.substr(11,2):v==N+1?h.innerHTML="Imorgon <br>klockan "+a[m].validTime.substr(11,2):"0"==g.charAt(0)?h.innerHTML=v+"/"+g.substr(1,1)+" <br>Klockan "+a[m].validTime.substr(11,2):h.innerHTML=v+"/"+g+" <br>Klockan "+a[m].validTime.substr(11,2);var f=document.createElement("span");f.className="weather-temp",f.innerHTML=a[m].t+"<i class='flaticon-weather'></i>";var b=document.createElement("span");b.className="weather-windspeed",b.innerHTML=a[m].ws+" m/s";var w=document.createElement("span");w.className="weather-winddirection";var y=document.createElement("i");y.className="fa fa-arrow-down",y.style.transform="rotate("+a[m].wd+"deg)",w.appendChild(y);var T=document.createElement("i"),E=document.createElement("span");E.className="weather-text",E.innerHTML=u[a[m].tcc]+".",0==a[m].pit?(T.className=d[a[m].tcc]+" cloudicon",E.innerHTML+="<br>Ingen nederbörd"):a[m].pit>0&&a[m].pit<=.2?(E.innerHTML+="<br>Lätt nederbörd<br>"+a[m].pit+" mm/h",a[m].tcc<5?T.className=c[0]+" cloudicon":T.className=c[1]+" cloudicon"):a[m].pit>.2&&a[m].pit<=.8?(E.innerHTML+="<br>Måttlig Nederbörd<br>"+a[m].pit+" mm/h",a[m].tcc<5?T.className=c[0]+" cloudicon":T.className=c[1]+" cloudicon"):a[m].pit>.8&&(E.innerHTML+="<br>Kraftig Nederbörd<br>"+a[m].pit+" mm/h",T.className=c[1]+" cloudicon"),p.appendChild(h),p.appendChild(T),p.appendChild(E),p.appendChild(f),p.appendChild(b),p.appendChild(w),$(".weather-container").append(p)}},error:function(){console.log("Inget svar från SMHI API")}})}function h(e){function t(t,n){q=n?e[t]:e;for(var a in q.ResponseData){if(q.ResponseData[a].constructor===Array&&q.ResponseData[a].length>0&&("Trams"==a||"Metros"==a||"Buses"==a||"Ships"==a)){var r=document.createElement("div");n?r.className="station-container":r.className="station-container-open";var s=document.createElement("span");s.className="station-name",s.innerText=q.ResponseData[a][0].StopAreaName+" ";var i=document.createElement("span");n&&(i.className="distance-to-station",i.innerText=q.distance+" meter");var o=document.createElement("span");o.innerText=q.ResponseData[a][0].SiteId;var l=document.createElement("h3");l.appendChild(s),l.appendChild(i),l.appendChild(o),r.appendChild(l);var d=document.createElement("ul");n?d.className="departure-list":d.className="departure-list-open";for(var c=0;c<q.ResponseData[a].length;c++){var u=document.createElement("li"),m=document.createElement("span");m.innerHTML=q.ResponseData[a][c].LineNumber+" ";var p=document.createElement("span");"BUS"==q.ResponseData[a][c].TransportMode?p.innerHTML="Buss ":"METRO"==q.ResponseData[a][c].TransportMode?p.innerHTML="Tunnelbana ":"TRAM"==q.ResponseData[a][c].TransportMode?p.innerHTML="Lokalbana ":"BOAT"==q.ResponseData[a][c].TransportMode&&(p.innerHTML="Båt ");var h=document.createElement("span");h.innerHTML=q.ResponseData[a][c].Destination+" ";var v=document.createElement("span");v.innerHTML=q.ResponseData[a][c].DisplayTime,u.appendChild(p),u.appendChild(m),u.appendChild(h),u.appendChild(v),d.appendChild(u)}r.appendChild(d)}$(".public-transport-container").append(r)}}if(e.constructor===Array)for(var n=0;n<e.length;n++){t(n,!0);var a=document.createElement("span");a.innerHTML=e[n].distance}else t(0,!1)}function v(){1==settings.showDeparturesNow&&($(".loader").show(),u())}function g(e,t){$(".public-transport-container").html(""),$.ajax({type:"GET",url:"closedepartures.php?lat="+e+"&+long="+t,dataType:"JSON",success:function(e){h(e);var t=0;Q=!1,$(".duplicate-container").remove();var n=document.getElementsByClassName("station-container"),a=n.length-1;$("body").keydown(function(e){27==e.keyCode?w():39==e.keyCode?Q&&(t==a?t=0:t++,$(".modal-inner").html("<div class='flex-center'><div class='modal-inner-div'>"+n[t].innerHTML+"</div></div>")):37==e.keyCode&&Q&&(0==t?t=a:t--,$(".modal-inner").html("<div class='flex-center'><div class='modal-inner-div'>"+n[t].innerHTML+"</div></div>"))}),$(".modal-left-arrow").click(function(){Q&&(0==t?t=a:t--,$(".modal-inner").html("<div class='flex-center'><div class='modal-inner-div'>"+n[t].innerHTML+"</div></div>"))}),$(".modal-right-arrow").click(function(){Q&&(t==a?t=0:t++,$(".modal-inner").html("<div class='flex-center'><div class='modal-inner-div'>"+n[t].innerHTML+"</div></div>"))}),$(".station-container").click(function(){$(".modal-container").css({visibility:"visible",opacity:1}),$(".modal-container").addClass("modal-with-arrows"),Q=!0,t=$(this).index(),$(".modal-inner").html("<div class='flex-center'><div class='modal-inner-div'>"+n[t].innerHTML+"</div></div>")}),$(".departure-list").each(function(){$(this).parent().append("<div class='number-of-departures'>Visa alla "+this.children.length+" avgångar.</div>")}),$(".loader").hide()},error:function(){console.log("Inget svar från API")}})}function f(e,t,n,a,r){var s=document.getElementsByClassName("modal-inner")[0];s.innerHTML="";var i=document.createElement("div");i.className="modal-search";var o=document.createElement("h3");o.innerText=r;var l=document.createElement("input");l.setAttribute("type","text"),l.id=e,l.setAttribute("placeholder",t);var d=document.createElement("button");d.id=n,d.innerText=a,i.appendChild(o),i.appendChild(l),i.appendChild(d),s.appendChild(i)}function b(){var e=document.getElementById("station-name").value;$(".public-transport-container").html("");var t=$(".loader").clone();$(".modal-inner").append(t),""!=e&&$.ajax({type:"GET",url:"searchstation.php?stationname="+e,dataType:"JSON",success:function(e){$(".modal-inner.loader").css({display:"none"}),w(),h(e)},error:function(){}})}function w(){Q=!1,$(".modal-container").css({opacity:0}),$(".modal-container").removeClass("modal-with-arrows"),setTimeout(function(){$(".modal-container").css({visibility:"hidden"})},200)}function y(){function e(e){var t=/(https?:\/\/[^\s]+)/g;return e.replace(t,function(e){return"<a href='"+e+"' class='twitter-link' target='_blank'>Läs mer</a>"})}function t(e){var t=e.substr(0,3),n=e.substr(4,3),a=e.substr(8,2),r=e.substr(11,5);return"Sat"==t?t="Lördag":"Sun"==t?t="Söndag":"Mon"==t?t="Måndag":"Tue"==t?t="Tisdag":"Wed"==t?t="Onsdag":"Thu"==t?t="Torsdag":"Fri"==t&&(t="Fredag"),t+" "+a+" "+n+" Klockan: "+r}$(".twitter-container").html(""),$(".twitter-account").html(settings.twitterAccount),$.ajax({type:"GET",url:"twitter.php?twitterAccount="+settings.twitterAccount+"&numberofTweets="+settings.numberofTweets,dataType:"json",success:function(n){for(var a,r,s,i=document.getElementsByClassName("twitter-container")[0],o=0;o<n.length;o++)a=document.createElement("div"),a.className="tweet-container",r=document.createElement("p"),r.className="tweet-date",r.innerText=t(n[o].created_at),s=document.createElement("p"),s.className="tweet-content",s.innerHTML=e(n[o].text),a.appendChild(r),a.appendChild(s),i.appendChild(a);$(".tweet-container").each(function(){$(this).find(".twitter-link").wrapAll("<div class='twitter-link-container'></div>")})},error:function(){$(".twitter-container").html("Inget svar från Twitters API"),console.log("Inget svar från Twitters API")}})}var T=new Date,E=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],C=["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],k=T.getDay(),N=T.getDate(),L=T.getMonth(),M=T.getFullYear();$(".date").html(E[k]+" "+N+" "+C[L]),setInterval(function(){e()},1e3),$.ajax({type:"GET",url:"http://api.dryg.net/dagar/v2.1/"+M+"/"+(L+1)+"/"+N,dataType:"JSON",success:function(e){var t=document.getElementsByClassName("date-info")[0],n=e.dagar[0],a=document.createElement("p");a.innerText="Vecka: "+n.vecka,t.appendChild(a);for(var r in n)if("röd dag"==r){var s=document.createElement("p");s.innerText="Helgdag: "+n[r],t.appendChild(s)}var i,o=n.namnsdag,l=document.createElement("p");l.innerText="Namnsdag idag: ";for(var d=0;d<o.length;d++)i=document.createElement("span"),0==d&&o.length>0?i.innerText=o[d]+" & ":i.innerText=o[d],l.appendChild(i);t.appendChild(l)},error:function(){console.log("Inget svar från Dagens API")}}),$(".toggle-settings").click(function(){$(".settings-container").toggleClass("open"),$(".settings-container").hasClass("open")?$(".settings-text").html("Stäng"):$(".settings-text").html("Öppna")}),$("#submit-btn").click(function(){$(".submit-btn-save-todb").fadeIn(300).delay(800).fadeOut(400),$(".save-loader").fadeIn(300).delay(800).fadeOut(400),$(".submit-btn-save").fadeOut(300).delay(800).fadeIn(400)}),$(".close-settings-btn").click(function(){$(".settings-container").removeClass("open"),$(".settings-container").hasClass("open")?$(".settings-text").html("Stäng"):$(".settings-text").html("Öppna")}),window.settings={numberofCalenderActivities:3,twitterAccount:"dagensnyheter",numberofTweets:5,numberofWeatherRapports:4,intervalOfWeatherRapports:8,showDeparturesNow:!1};var D=new Firebase("https://vilhelmdashboard.firebaseio.com"),A={numberofCalenderActivities:3,twitterAccount:"dagensnyheter",numberofTweets:5,numberofWeatherRapports:5,intervalOfWeatherRapports:6,showDeparturesNow:!1},H=document.getElementById("google-cal-amount"),x=document.getElementById("twitter-follow"),I=document.getElementById("twitter-posts-amount"),B=document.getElementById("weather-rapport-amount"),R=document.getElementById("weather-rapport-interval"),S=document.getElementById("show-close-departures-now"),U=document.getElementById("load-close-departures-now"),O=0,j=D.getAuth(),W=document.getElementsByClassName("user-name");if(null!=j)for(var P=0;P<W.length;P++)W[P].innerHTML="Inloggad som "+j.password.email;var K=document.getElementsByClassName("explaination")[0],G=document.getElementsByClassName("sign-up-btn");G[1].addEventListener("click",function(){document.getElementsByClassName("settings-container")[0].className="settings-container open",J[0].style.display="none",G[0].style.display="block",$(".error-message").html("")}),G[0].addEventListener("click",function(){n(document.getElementsByClassName("user-email-adress")[0].value,document.getElementsByClassName("user-password")[0].value)});var J=(document.getElementsByClassName("sign-in-container"),document.getElementsByClassName("log-in-btn"));J[1].addEventListener("click",function(){document.getElementsByClassName("settings-container")[0].className="settings-container open",J[0].style.display="block",G[0].style.display="none",$(".error-message").html("")}),J[0].addEventListener("click",function(){var e=document.getElementsByClassName("user-email-adress")[0].value,t=document.getElementsByClassName("user-password")[0].value;a(e,t,!1)}),D.onAuth(r);for(var _=document.getElementsByClassName("log-out-btn"),P=0;P<_.length;P++)_[P].addEventListener("click",s);S.addEventListener("click",function(){1==this.checked?U.innerHTML="Ja":U.innerHTML="Nej"});var F=document.getElementById("submit-btn");F.addEventListener("click",i);var V=D;j=D.getAuth(),V.on("value",function(e){var n=e.val();if(j){for(var a in n.dashboardUsers)if(a==j.uid)return H.value=n.dashboardUsers[a].numberofCalenderActivities,x.value=n.dashboardUsers[a].twitterAccount,I.value=n.dashboardUsers[a].numberofTweets,B.value=n.dashboardUsers[a].numberofWeatherRapports,R.value=n.dashboardUsers[a].intervalOfWeatherRapports,S.checked=n.dashboardUsers[a].showDeparturesNow,1==S.checked?U.innerHTML="Ja":U.innerHTML="Nej",window.settings={numberofCalenderActivities:parseInt(n.dashboardUsers[a].numberofCalenderActivities),twitterAccount:n.dashboardUsers[a].twitterAccount,numberofTweets:n.dashboardUsers[a].numberofTweets,numberofWeatherRapports:n.dashboardUsers[a].numberofWeatherRapports,intervalOfWeatherRapports:n.dashboardUsers[a].intervalOfWeatherRapports,showDeparturesNow:n.dashboardUsers[a].showDeparturesNow},t(" database.on(value, function(snapshot) {"),!1}else t("else database.on(value, function(snapshot) {);")},function(e){});var z,Y,q,Q;v(),$(".find-close-departures").click(function(){$(".loader").show(),u()});var X;$(".find-specific-departures").click(function(){Q=!0,f("station-name","Skriv namn på station","station-search","Sök resa","Sök resa med SL"),$(".modal-container").css({visibility:"visible",opacity:1}),X=document.getElementById("station-search"),X.addEventListener("click",b)}),$(".close-modal-btn").click(function(){w()}),$("body").keydown(function(e){1==Q&&27==e.keyCode&&w()})})}();var CLIENT_ID="765342006289-i5i1df5rcv6sg6vh4ejm30f9lm1tjrhc.apps.googleusercontent.com",SCOPES=["https://www.googleapis.com/auth/calendar.readonly"],counter=0,day,month,year,time,dateString,weekDay,weekDays=["söndag","måndag","tisdag","onsdag","torsdag","fredag","lördag"],months=["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"];